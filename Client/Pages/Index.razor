@page "/chat/{Room}"
@using Microsoft.AspNetCore.Authorization
@attribute [AllowAnonymous]

<div class="@UIMode" id="client-main">
    <NavSection @ref="@NavSection" DarkModeToggleCallback="@ToggleDarkMode" />
    <ChatSection @ref="@ChatSection" UIMode="@UIMode" Room="@Room" />
    <UserSection Room="@Room" Username="@Username" UIMode="@UIMode" />
    <NotificationBanner />
</div>

<UsernamePrompt @ref="@UsernamePrompt" IndexCallback="@SetUsername" />

@code {
    [Parameter] public string Room { get; set; }
    private UsernamePrompt UsernamePrompt { get; set; }
    private string Username { get; set; }
    private string UIMode { get; set; } = "W-Mode";
    private ChatSection ChatSection { get; set; }
    private NavSection NavSection { get; set; }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            UsernamePrompt.Show();
        }
    }

    public async Task SetUsername(string Username)
    {
        this.Username = Username;

        await ChatSection.InitializeSignalR(Username);
    }

    public void ToggleDarkMode(object Source)
    {
        UIMode = UIMode == "W-Mode" ? "D-Mode" : "W-Mode";

        StateHasChanged();
    }
}